<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JoVi POS Básico</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5KwQ/uRxpzx/LCPQcbhZdVByXBNj2ifvCAgFOhlycKbMxxkchpSMQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Estilos globales y básicos */
    body {
      font-family: sans-serif;
      background-color: #1a202c; /* Fondo oscuro simple */
      color: #e2e8f0; /* Texto claro */
    }

    /* Ocultar secciones por defecto */
    .section {
      display: none;
    }

    /* Estilos básicos para el login */
    #login-section {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #1a202c;
    }
    #login-section .login-box {
      background-color: #2d3748;
      padding: 2rem;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 24rem;
      max-width: 90%;
    }
    #login-section .login-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #4a5568;
      border-radius: 0.5rem;
      background-color: #2d3748;
      color: #e2e8f0;
      outline: none;
    }
    #login-section .login-button {
      width: 100%;
      padding: 0.75rem;
      background-color: #00FFFF;
      color: #1a202c;
      font-weight: 600;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    #login-section .login-error {
        color: #fc8181;
        font-size: 0.875rem;
        margin-top: 0.75rem;
        display: none;
    }
    #login-section .login-link {
        color: #00FFFF;
        font-size: 0.875rem;
        text-decoration: none;
        margin-top: 0.75rem;
        display: block;
        text-align: right;
    }

    /* Estilos básicos para las tablas (productos) */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }
    th, td {
        padding: 0.5rem;
        text-align: left;
        border-bottom: 1px solid #4a5568;
    }
    th {
        background-color: #2d3748;
    }
    .hover-bg-gray-700:hover {
        background-color: #4a5568;
    }
    .text-red-500 {
        color: #ef4444;
    }
    .cursor-pointer {
        cursor: pointer;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans">

  <section id="login-section">
    <i class="fas fa-microchip w-32 h-32 mb-6 text-[#00FFFF]"></i>
    <h1 class="text-4xl font-extrabold text-white mb-6">Bienvenido a JoVi POS</h1>
    <div class="login-box">
      <div class="mb-4">
        <label for="user" class="block text-gray-300 font-medium mb-1">Usuario</label>
        <input id="user" type="text" placeholder="admin" class="login-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
      </div>
      <div class="mb-4">
        <label for="pass" class="block text-gray-300 font-medium mb-1">Contraseña</label>
        <input id="pass" type="password" placeholder="••••••" class="login-input" autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false" />
      </div>
      <button id="btnLogin" class="login-button">
        Iniciar Sesión
      </button>
      <p id="login-error" class="login-error">Usuario o contraseña incorrecta</p>
      <p class="mt-3 text-right">
        <a href="#" id="forgot-password" class="login-link">¿Olvidaste la contraseña?</a>
      </p>
    </div>
  </section>

  <section id="pos-section" class="hidden">

    <nav class="bg-gray-800 shadow-lg p-4 flex space-x-6 justify-center items-center sticky top-0 z-20 select-none">
      <i class="fas fa-microchip w-12 h-12 mr-4 text-[#00FFFF]"></i>
      <button onclick="showSection('ventas')" class="py-2 px-4 rounded-lg text-gray-200 hover:bg-gray-700">Ventas</button>
      <button onclick="showSection('productos')" class="py-2 px-4 rounded-lg text-gray-200 hover:bg-gray-700">Productos</button>
      <button onclick="showSection('clientes')" class="py-2 px-4 rounded-lg text-gray-200 hover:bg-gray-700">Clientes</button>
      <button onclick="showSection('creditos')" class="py-2 px-4 rounded-lg text-gray-200 hover:bg-gray-700">Créditos</button>
      <button onclick="showSection('inventario')" class="py-2 px-4 rounded-lg text-gray-200 hover:bg-gray-700">Inventario</button>
      <button onclick="showSection('configuraciones')" class="py-2 px-4 rounded-lg text-gray-200 hover:bg-gray-700">Configuraciones</button>
      <button onclick="showSection('reportes')" class="py-2 px-4 rounded-lg text-gray-200 hover:bg-gray-700">Reportes</button>
      <span class="ml-auto text-sm text-gray-400"><strong id="vendedor-info"></strong></span>
    </nav>

    <main class="p-8 space-y-8">

      <div id="busqueda-container" class="hidden mb-8 max-w-4xl mx-auto">
        <label for="busqueda-producto" class="block text-xl font-bold mb-3 text-center text-[#00FFFF]">Buscar producto</label>
        <div class="relative">
          <input id="busqueda-producto" type="text" placeholder="Escribe para buscar..." class="w-full p-2 border border-[#00FFFF] rounded bg-gray-700 text-white" oninput="buscarProductos()" autocomplete="off" />
        </div>
        <div id="lista-resultados" class="bg-gray-700 border border-gray-600 rounded max-h-56 overflow-y-auto mt-2"></div>
      </div>

      <section id="ventas" class="section">
        <h2 class="text-2xl font-bold mb-4 text-[#00FFFF]">Ventas</h2>

        <div class="grid md:grid-cols-3 gap-6">

          <div>
            <h3 class="font-semibold mb-2 text-gray-300">Botones rápidos:</h3>
            <div id="botones-rapidos" class="flex flex-wrap gap-2"></div>
          </div>

          <div class="bg-gray-800 p-4 rounded shadow max-h-[480px] overflow-y-auto">
            <h3 class="font-semibold mb-2 text-gray-300">Carrito</h3>
            <table class="w-full text-left border-collapse text-gray-200">
              <thead class="bg-gray-700">
                <tr>
                  <th class="p-1">Producto</th>
                  <th class="p-1 w-20">Cant.</th>
                  <th class="p-1 w-24">Precio</th>
                  <th class="p-1 w-24">Subtotal</th>
                  <th class="p-1 w-12">Desc %</th>
                  <th class="p-1 w-10">Eliminar</th>
                </tr>
              </thead>
              <tbody id="carrito-items"></tbody>
            </table>
            <p class="mt-2 font-bold text-right text-gray-100">Total: $<span id="total-venta">0.00</span></p>

            <div class="mt-4">
              <label class="block mb-1 font-semibold text-gray-300">Descuento global %:</label>
              <input id="descuento-global" type="number" min="0" max="100" value="0" class="w-24 p-1 border border-gray-600 rounded bg-gray-700 text-white" oninput="aplicarDescuentoGlobal()" />
            </div>
          </div>

          <div>
            <h3 class="font-semibold mb-2 text-gray-300">Pago</h3>
            <label class="block mb-1 text-gray-300">Método de pago:</label>
            <select id="metodo-pago" class="w-full p-2 border border-gray-600 rounded mb-4 bg-gray-700 text-white" onchange="cambiarMetodoPago()">
              <option value="Efectivo">Efectivo</option>
              <option value="Tarjeta">Tarjeta</option>
              <option value="Transferencia">Transferencia</option>
            </select>

            <div id="efectivo-section">
              <label class="block mb-1 text-gray-300">Efectivo recibido:</label>
              <input id="efectivo-recibido" type="number" step="0.01" min="0" class="w-full p-2 border border-gray-600 rounded mb-2 bg-gray-700 text-white" oninput="calcularCambio()" />
              <p class="text-gray-300">Cambio: $<span id="cambio">0.00</span></p>
            </div>

            <button onclick="finalizarVenta()" class="mt-6 w-full bg-[#00FFFF] text-gray-900 py-3 rounded hover:bg-[#00CCCC]">
              Finalizar Venta
            </button>

            <h3 class="font-semibold mt-10 mb-2 text-gray-300">Caja Chica</h3>
            <input id="monto-caja" type="number" step="0.01" placeholder="Monto" class="w-full p-2 border border-gray-600 rounded mb-2 bg-gray-700 text-white" />
            <select id="tipo-caja" class="w-full p-2 border border-gray-600 rounded mb-2 bg-gray-700 text-white">
              <option value="entrada">Entrada</option>
              <option value="salida">Salida</option>
            </select>
            <button onclick="agregarCajaChica()" class="w-full bg-gray-700 text-white py-2 rounded hover:bg-gray-600">
              Registrar Movimiento
            </button>
            <ul id="movimientos-caja" class="mt-4 max-h-40 overflow-y-auto border border-gray-600 rounded p-2 bg-gray-800 text-sm text-gray-300"></ul>
          </div>

        </div>
      </section>

      <section id="productos" class="section">
        <h2 class="text-2xl font-bold mb-4 text-[#00FFFF]">Gestión de Productos</h2>
        <div class="bg-gray-800 p-4 rounded shadow mb-4 flex flex-col md:flex-row md:space-x-4">
          <div class="flex-1 space-y-3">
            <label class="block text-sm text-gray-300">Nombre</label>
            <input id="prod-nombre" placeholder="Nombre" class="w-full p-2 border border-gray-600 rounded bg-gray-700 text-white" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            <label class="block text-sm text-gray-300">Código</label>
            <input id="prod-codigo" placeholder="Código" class="w-full p-2 border border-gray-600 rounded bg-gray-700 text-white" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            <label class="block text-sm text-gray-300">Precio de costo</label>
            <input id="prod-precio-costo" placeholder="Precio de costo" type="number" class="w-full p-2 border border-gray-600 rounded bg-gray-700 text-white" step="0.01" min="0" />
            <label class="block text-sm text-gray-300">Precio de venta</label>
            <input id="prod-precio-venta" placeholder="Precio de venta" type="number" class="w-full p-2 border border-gray-600 rounded bg-gray-700 text-white" step="0.01" min="0" />
            <label class="block text-sm text-gray-300">Stock</label>
            <input id="prod-stock" placeholder="Stock" type="number" class="w-full p-2 border border-gray-600 rounded bg-gray-700 text-white" min="0" />
            <button onclick="saveProduct()" class="bg-[#00FFFF] text-gray-900 px-4 py-2 rounded-lg shadow hover:bg-[#00CCCC]">
              Guardar Producto
            </button>
          </div>
          <div class="flex-1 overflow-auto max-h-[520px]">
            <table class="w-full bg-gray-800 rounded shadow text-sm">
              <thead class="bg-gray-700 text-gray-200">
                <tr>
                  <th class="p-2 text-left">Nombre</th>
                  <th class="p-2 text-left">Código</th>
                  <th class="p-2 text-right">Costo</th>
                  <th class="p-2 text-right">Venta</th>
                  <th class="p-2 text-right">Stock</th>
                  <th class="p-2 text-center">Acciones</th>
                </tr>
              </thead>
              <tbody id="prod-table" class="text-gray-300"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="clientes" class="section">
        <h2 class="text-2xl font-bold mb-4 text-[#00FFFF]">Clientes</h2>
        <div class="bg-gray-800 p-4 rounded shadow mb-4">
          <label class="block mb-1 text-sm text-gray-300">Nombre</label>
          <input id="cli-nombre" placeholder="Nombre" class="w-full p-2 border border-gray-600 rounded mb-2 bg-gray-700 text-white" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          <label class="block mb-1 text-sm text-gray-300">Email</label>
          <input id="cli-email" placeholder="Email" type="email" class="w-full p-2 border border-gray-600 rounded mb-2 bg-gray-700 text-white" />
          <label class="block mb-1 text-sm text-gray-300">Teléfono</label>
          <input id="cli-telefono" placeholder="Teléfono" class="w-full p-2 border border-gray-600 rounded mb-2 bg-gray-700 text-white" />
          <button onclick="saveClient()" class="bg-[#00FFFF] text-gray-900 px-4 py-2 rounded-lg shadow hover:bg-[#00CCCC]">
            Guardar Cliente
          </button>
        </div>
        <ul id="client-list" class="bg-gray-800 p-4 rounded shadow h-80 overflow-y-auto text-gray-300"></ul>
      </section>

      <section id="creditos" class="section">
        <h2 class="text-2xl font-bold mb-4 text-[#00FFFF]">Créditos</h2>
        <p class="text-gray-400">Funcionalidad de créditos en desarrollo...</p>
      </section>

      <section id="inventario" class="section">
        <h2 class="text-2xl font-bold mb-4 text-[#00FFFF]">Inventario</h2>
        <div id="inventory-list" class="bg-gray-800 p-4 rounded shadow h-80 overflow-y-auto text-gray-300"></div>
      </section>

      <section id="configuraciones" class="section">
        <h2 class="text-2xl font-bold mb-4 text-[#00FFFF]">Configuraciones</h2>
        <p class="text-gray-400">Ajustes del sistema en desarrollo...</p>
      </section>

      <section id="reportes" class="section">
        <h2 class="text-2xl font-bold mb-4 text-[#00FFFF]">Reportes</h2>
        <div id="reporte" class="bg-gray-800 p-4 rounded shadow text-sm h-80 overflow-y-auto text-gray-300">
          <p class="text-gray-400">Aquí se mostrarán los reportes próximamente...</p>
        </div>
      </section>

    </main>

  </section>

  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
        // feather.replace(); // Deshabilitado temporalmente para máxima simplificación

        // Datos de acceso válidos
        const USUARIO_VALIDO = "admin";
        const CONTRASENA_VALIDA = "12345";

        // Elementos login y sistema
        const loginSection = document.getElementById("login-section");
        const posSection = document.getElementById("pos-section");
        const loginError = document.getElementById("login-error");
        const vendedorInfo = document.getElementById("vendedor-info");
        const inputUser = document.getElementById("user");
        const inputPass = document.getElementById("pass");
        const btnLogin = document.getElementById("btnLogin");

        // Secciones
        const sections = document.querySelectorAll("section.section");

        // Productos almacenados
        let productos = JSON.parse(localStorage.getItem("productos")) || [];

        // Clientes almacenados
        let clientes = JSON.parse(localStorage.getItem("clientes")) || [];

        // Variables para ventas
        let carrito = [];
        let descuentoGlobal = 0;

        // --- Funciones de Inicialización ---
        function initializeApp() {
            renderProductos(); // Carga y muestra los productos existentes
            renderClientes();  // Carga y muestra los clientes existentes
            mostrarMovimientosCaja(); // Carga y muestra los movimientos de caja
            cambiarMetodoPago(); // Asegura que la sección de efectivo se muestre/oculte correctamente al inicio
            // No llamar showSection aquí, para que el login sea lo primero
        }

        // Mostrar sección deseada
        function showSection(id) {
          sections.forEach(sec => {
            sec.id === id ? sec.style.display = "block" : sec.style.display = "none";
          });
          // Mostrar campo buscar solo en ventas
          document.getElementById("busqueda-container").style.display = id === "ventas" ? "block" : "none";
        }

        // Manejo login
        function login() {
          const user = inputUser.value.trim();
          const pass = inputPass.value.trim();
          if(user === USUARIO_VALIDO && pass === CONTRASENA_VALIDA) {
            loginError.style.display = "none";
            loginSection.style.display = "none";
            posSection.style.display = "block"; // Mostrar el POS
            
            vendedorInfo.textContent = user;
            showSection("ventas"); // Muestra la sección de ventas por defecto al iniciar sesión
            inputUser.value = "";
            inputPass.value = "";
          } else {
            loginError.style.display = "block";
          }
        }

        // Atajo Enter para login
        [inputUser, inputPass].forEach(input => {
          input.addEventListener("keypress", e => {
            if(e.key === "Enter") {
              login();
            }
          });
        });

        btnLogin.addEventListener("click", login);

        // Buscar productos (en ventas)
        function buscarProductos() {
          const query = document.getElementById("busqueda-producto").value.trim().toLowerCase();
          const lista = document.getElementById("lista-resultados");
          lista.innerHTML = "";
          if(query.length === 0) return;
          const resultados = productos.filter(p =>
            p.nombre.toLowerCase().includes(query) ||
            p.codigo.toLowerCase().includes(query)
          );
          if(resultados.length === 0) {
            lista.innerHTML = "<p class='p-2 text-gray-500'>No hay resultados</p>";
            return;
          }
          resultados.forEach(p => {
            const div = document.createElement("div");
            div.className = "p-2 cursor-pointer hover:bg-[#00FFFF] hover:text-gray-900";
            div.textContent = `${p.nombre} (${p.codigo}) - $${p.precioVenta.toFixed(2)}`;
            div.onclick = () => agregarAlCarrito(p.codigo);
            lista.appendChild(div);
          });
        }

        // Agregar producto al carrito
        function agregarAlCarrito(codigo) {
          const producto = productos.find(p => p.codigo === codigo);
          if(!producto) return alert("Producto no encontrado");
          let item = carrito.find(i => i.codigo === codigo);
          if(item) {
            if(item.cantidad < producto.stock) {
              item.cantidad++;
            } else {
              alert("No hay suficiente stock");
              return;
            }
          } else {
            carrito.push({
              codigo: producto.codigo,
              nombre: producto.nombre,
              precio: producto.precioVenta,
              cantidad: 1,
              descuento: 0
            });
          }
          actualizarCarrito();
          document.getElementById("busqueda-producto").value = "";
          document.getElementById("lista-resultados").innerHTML = "";
        }

        // Actualizar carrito en la tabla y total
        function actualizarCarrito() {
          const tbody = document.getElementById("carrito-items");
          tbody.innerHTML = ""; 
          let total = 0;
          carrito.forEach((item, idx) => {
            const subtotal = (item.precio * item.cantidad) * (1 - item.descuento/100);
            total += subtotal;
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td class="p-1">${item.nombre}</td>
              <td class="p-1 w-20">
                <input type="number" min="1" max="999" value="${item.cantidad}" data-idx="${idx}" class="cantidad-input w-full border border-gray-600 rounded p-1 bg-gray-700 text-white" />
              </td>
              <td class="p-1 w-24 text-right">$${subtotal.toFixed(2)}</td>
              <td class="p-1 w-12">
                <input type="number" min="0" max="100" value="${item.descuento}" data-idx-desc="${idx}" class="descuento-input w-full border border-gray-600 rounded p-1 bg-gray-700 text-white" />
              </td>
              <td class="p-1 w-10 text-center cursor-pointer text-red-500" data-idx-del="${idx}">&times;</td>
            `;
            tbody.appendChild(tr);
          });
          document.getElementById("total-venta").textContent = total.toFixed(2);

          // Eventos para inputs cantidad y descuento
          document.querySelectorAll(".cantidad-input").forEach(input => {
            input.addEventListener("change", e => {
              const i = parseInt(e.target.dataset.idx);
              let val = parseInt(e.target.value);
              if (val < 1 || isNaN(val)) val = 1;
              const stock = productos.find(p => p.codigo === carrito[i].codigo).stock;
              if(val > stock) {
                alert("No hay suficiente stock. Máximo disponible: " + stock);
                val = stock;
              }
              carrito[i].cantidad = val;
              actualizarCarrito();
            });
          });
          document.querySelectorAll(".descuento-input").forEach(input => {
            input.addEventListener("change", e => {
              const i = parseInt(e.target.dataset.idxDesc);
              let val = parseFloat(e.target.value);
              if (val < 0 || isNaN(val)) val = 0;
              if (val > 100) val = 100;
              carrito[i].descuento = val;
              actualizarCarrito();
            });
          });
          // Eliminar item
          document.querySelectorAll("[data-idx-del]").forEach(el => {
            el.addEventListener("click", e => {
              const i = parseInt(e.target.dataset.idxDel);
              carrito.splice(i, 1);
              actualizarCarrito();
            });
          });
        }

        // Aplicar descuento global (sobre total)
        function aplicarDescuentoGlobal() {
          const val = parseFloat(document.getElementById("descuento-global").value);
          descuentoGlobal = isNaN(val) ? 0 : val;
          actualizarCarrito();
        }

        // Cambiar método de pago (mostrar efectivo si aplica)
        function cambiarMetodoPago() {
          const metodo = document.getElementById("metodo-pago").value;
          document.getElementById("efectivo-section").style.display = metodo === "Efectivo" ? "block" : "none";
        }

        // Calcular cambio efectivo
        function calcularCambio() {
          const efectivo = parseFloat(document.getElementById("efectivo-recibido").value);
          const total = parseFloat(document.getElementById("total-venta").textContent);
          let cambio = 0;
          if(!isNaN(efectivo)) {
            cambio = efectivo - total;
            if(cambio < 0) cambio = 0; 
          }
          document.getElementById("cambio").textContent = cambio.toFixed(2);
        }

        // Finalizar venta
        function finalizarVenta() {
          if(carrito.length === 0) return alert("El carrito está vacío");

          alert("Venta finalizada. Total: $" + document.getElementById("total-venta").textContent);
          
          // Resetear estado
          carrito = [];
          actualizarCarrito();
          document.getElementById("descuento-global").value = 0;
          document.getElementById("efectivo-recibido").value = "";
          document.getElementById("cambio").textContent = "0.00";
        }

        // Caja chica
        let movimientosCaja = JSON.parse(localStorage.getItem("movimientosCaja")) || [];
        const listaMovimientos = document.getElementById("movimientos-caja");
        function agregarCajaChica() {
          const monto = parseFloat(document.getElementById("monto-caja").value);
          const tipo = document.getElementById("tipo-caja").value;
          if(isNaN(monto) || monto <= 0) return alert("Monto inválido");
          movimientosCaja.push({monto, tipo, fecha: new Date().toLocaleString()});
          localStorage.setItem("movimientosCaja", JSON.stringify(movimientosCaja));
          mostrarMovimientosCaja();
          document.getElementById("monto-caja").value = "";
          document.getElementById("tipo-caja").value = "entrada";
        }
        function mostrarMovimientosCaja() {
          listaMovimientos.innerHTML = "";
          movimientosCaja.forEach((m, i) => {
            const li = document.createElement("li");
            li.textContent = `[${m.fecha}] ${m.tipo === "entrada" ? "+" : "-"}$${m.monto.toFixed(2)}`;
            listaMovimientos.appendChild(li);
          });
        }

        // Gestión productos
        function saveProduct() {
          const nombre = document.getElementById("prod-nombre").value.trim();
          const codigo = document.getElementById("prod-codigo").value.trim();
          const precioCosto = parseFloat(document.getElementById("prod-precio-costo").value);
          const precioVenta = parseFloat(document.getElementById("prod-precio-venta").value);
          const stock = parseInt(document.getElementById("prod-stock").value);

          if(!nombre || !codigo || isNaN(precioCosto) || isNaN(precioVenta) || isNaN(stock)) {
            return alert("Por favor, completa todos los campos correctamente.");
          }

          let isNewProduct = true;
          productos = productos.map(p => {
            if(p.codigo === codigo) {
              // Actualizar producto existente
              p.nombre = nombre;
              p.precioCosto = precioCosto;
              p.precioVenta = precioVenta;
              p.stock = stock;
              isNewProduct = false;
            }
            return p;
          });

          if(isNewProduct) {
            productos.push({nombre, codigo, precioCosto, precioVenta, stock});
          }

          localStorage.setItem("productos", JSON.stringify(productos));
          limpiarFormProducto();
          renderProductos();
          alert("Producto guardado correctamente.");
        }
        function limpiarFormProducto() {
          document.getElementById("prod-nombre").value = "";
          document.getElementById("prod-codigo").value = "";
          document.getElementById("prod-precio-costo").value = "";
          document.getElementById("prod-precio-venta").value = "";
          document.getElementById("prod-stock").value = "";
        }
        function renderProductos() {
          const tbody = document.getElementById("prod-table");
          tbody.innerHTML = "";
          if (productos.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="p-4 text-center text-gray-500">No hay productos registrados.</td></tr>';
            return;
          }
          productos.forEach((p, i) => {
            const tr = document.createElement("tr");
            tr.classList.add("hover-bg-gray-700"); /* Clase simplificada para hover */
            tr.innerHTML = `
              <td class="p-2">${p.nombre}</td>
              <td class="p-2">${p.codigo}</td>
              <td class="p-2 text-right">$${p.precioCosto.toFixed(2)}</td>
              <td class="p-2 text-right">$${p.precioVenta.toFixed(2)}</td>
              <td class="p-2 text-right">${p.stock}</td>
              <td class="p-2 text-center cursor-pointer text-red-500" data-index="${i}">&times;</td>
            `;
            tbody.appendChild(tr);
          });
          // Eliminar producto
          tbody.querySelectorAll("[data-index]").forEach(td => {
            td.addEventListener("click", e => {
              const idx = parseInt(e.target.dataset.index);
              if(confirm("¿Eliminar producto? Esta acción no se puede deshacer.")) {
                productos.splice(idx, 1);
                localStorage.setItem("productos", JSON.stringify(productos));
                renderProductos();
              }
            });
          });
        }

        // Gestión clientes simple
        function saveClient() {
          const nombre = document.getElementById("cli-nombre").value.trim();
          const email = document.getElementById("cli-email").value.trim();
          const telefono = document.getElementById("cli-telefono").value.trim();
          if(!nombre) return alert("El nombre es obligatorio");
          
          clientes.push({nombre, email, telefono});
          localStorage.setItem("clientes", JSON.stringify(clientes));
          renderClientes();
          document.getElementById("cli-nombre").value = "";
