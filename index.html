<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JoVi POS Avanzado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .animate-fadeIn { animation: fadeIn 0.5s ease-in-out; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

  <!-- LOGIN -->
  <section id="login-section" class="min-h-screen flex flex-col justify-center items-center bg-gradient-to-br from-[#00BFFF] to-[#005F9E] animate-fadeIn">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 mb-6 text-white animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17h4.5m-6-5.25h7.5M12 2a10 10 0 0 1 10 10v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-4a10 10 0 0 1 10-10z" />
    </svg>
    <h1 class="text-4xl font-extrabold text-white mb-6 drop-shadow-lg">Bienvenido a JoVi POS</h1>
    <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl w-96 animate-fadeIn">
      <div class="mb-4">
        <label for="user" class="block text-gray-700 font-medium mb-1"><i data-feather="user" class="inline-block mr-2"></i>Usuario</label>
        <input id="user" type="text" placeholder="admin" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00BFFF] transition" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
      </div>
      <div class="mb-4">
        <label for="pass" class="block text-gray-700 font-medium mb-1"><i data-feather="lock" class="inline-block mr-2"></i>Contraseña</label>
        <input id="pass" type="password" placeholder="••••••" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00BFFF] transition" autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false" />
      </div>
      <button id="btnLogin" class="w-full bg-[#00BFFF] text-white font-semibold py-3 rounded-lg shadow-lg hover:bg-[#007ACC] transition-colors duration-300 flex justify-center items-center">
        <i data-feather="log-in" class="inline-block mr-2"></i>Iniciar Sesión
      </button>
      <p id="login-error" class="text-red-500 text-sm mt-3 hidden">Usuario o contraseña incorrecta</p>
      <p class="mt-3 text-right">
        <a href="#" id="forgot-password" class="text-[#00BFFF] hover:underline text-sm">¿Olvidaste la contraseña?</a>
      </p>
    </div>
  </section>

  <!-- POS SISTEMA -->
  <section id="pos-section" class="hidden animate-fadeIn">

    <!-- NAV HORIZONTAL -->
    <nav class="bg-white shadow-md p-4 flex space-x-6 justify-center items-center sticky top-0 z-20 select-none">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mr-4 text-[#00BFFF] animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17h4.5m-6-5.25h7.5M12 2a10 10 0 0 1 10 10v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-4a10 10 0 0 1 10-10z" />
      </svg>
      <button onclick="showSection('ventas')" class="flex items-center py-2 px-4 rounded-lg hover:bg-gray-100 transition" title="F1 - Ventas"><i data-feather="shopping-cart" class="mr-2"></i>Ventas</button>
      <button onclick="showSection('productos')" class="flex items-center py-2 px-4 rounded-lg hover:bg-gray-100 transition" title="F2 - Productos"><i data-feather="box" class="mr-2"></i>Productos</button>
      <button onclick="showSection('clientes')" class="flex items-center py-2 px-4 rounded-lg hover:bg-gray-100 transition" title="F3 - Clientes"><i data-feather="users" class="mr-2"></i>Clientes</button>
      <button onclick="showSection('creditos')" class="flex items-center py-2 px-4 rounded-lg hover:bg-gray-100 transition" title="F4 - Créditos"><i data-feather="credit-card" class="mr-2"></i>Créditos</button>
      <button onclick="showSection('inventario')" class="flex items-center py-2 px-4 rounded-lg hover:bg-gray-100 transition" title="F5 - Inventario"><i data-feather="database" class="mr-2"></i>Inventario</button>
      <button onclick="showSection('configuraciones')" class="flex items-center py-2 px-4 rounded-lg hover:bg-gray-100 transition" title="F6 - Configuraciones"><i data-feather="settings" class="mr-2"></i>Configuraciones</button>
      <button onclick="showSection('reportes')" class="flex items-center py-2 px-4 rounded-lg hover:bg-gray-100 transition" title="F7 - Reportes"><i data-feather="bar-chart-2" class="mr-2"></i>Reportes</button>
      <span class="ml-auto text-sm text-gray-500 flex items-center"><i data-feather="user-check" class="inline-block mr-1"></i><strong id="vendedor-info"></strong></span>
    </nav>

    <main class="p-8 space-y-8">

      <!-- Campo BUSCAR PRODUCTO destacado arriba solo en sección Ventas -->
      <div id="busqueda-container" class="hidden mb-8 max-w-4xl mx-auto">
        <label for="busqueda-producto" class="block text-4xl font-extrabold mb-3 text-center text-[#00BFFF]">Buscar producto</label>
        <input id="busqueda-producto" type="text" placeholder="Escribe para buscar..." class="w-full p-4 border-4 border-[#00BFFF] rounded-xl shadow-lg text-2xl" oninput="buscarProductos()" autocomplete="off" />
        <div id="lista-resultados" class="bg-white border rounded max-h-56 overflow-y-auto mt-2"></div>
      </div>

      <!-- Ventas -->
      <section id="ventas" class="section animate-fadeIn">
        <h2 class="text-3xl font-bold mb-4 flex items-center"><i data-feather="shopping-cart" class="mr-2"></i>Ventas</h2>

        <div class="grid md:grid-cols-3 gap-6">

          <!-- Carrito GRANDE -->
          <div class="bg-white p-4 rounded shadow max-h-[600px] overflow-y-auto col-span-2">
            <h3 class="font-semibold mb-2 text-xl">Carrito</h3>
            <table class="w-full text-left border-collapse">
              <thead class="bg-gray-100">
                <tr>
                  <th class="p-2">Producto</th>
                  <th class="p-2 w-20">Cantidad</th>
                  <th class="p-2 w-24">Precio</th>
                  <th class="p-2 w-24">Subtotal</th>
                  <th class="p-2 w-16">Desc %</th>
                  <th class="p-2 w-14">Eliminar</th>
                </tr>
              </thead>
              <tbody id="carrito-items"></tbody>
            </table>
            <p class="mt-4 font-bold text-right text-xl">Total: $<span id="total-venta">0.00</span></p>

            <div class="mt-6 flex items-center space-x-4">
              <label class="block font-semibold">Descuento global %:</label>
              <input id="descuento-global" type="number" min="0" max="100" value="0" class="w-24 p-2 border rounded" oninput="aplicarDescuentoGlobal()" />
            </div>
          </div>

          <!-- Pago en esquina derecha -->
          <div class="bg-white p-4 rounded shadow max-h-[600px] overflow-y-auto sticky top-24 self-start w-full max-w-sm">
            <h3 class="font-semibold mb-4 text-xl">Pago</h3>
            <label>Método de pago:</label>
            <select id="metodo-pago" class="w-full p-2 border rounded mb-4" onchange="cambiarMetodoPago()">
              <option value="Efectivo">Efectivo</option>
              <option value="Tarjeta">Tarjeta</option>
              <option value="Transferencia">Transferencia</option>
            </select>

            <div id="efectivo-section">
              <label>Efectivo recibido:</label>
              <input id="efectivo-recibido" type="number" step="0.01" min="0" class="w-full p-2 border rounded mb-2" oninput="calcularCambio()" />
              <p>Cambio: $<span id="cambio">0.00</span></p>
            </div>

            <button onclick="finalizarVenta()" class="mt-6 w-full bg-[#00BFFF] text-white py-3 rounded hover:bg-[#007ACC] transition flex justify-center items-center">
              <i data-feather="check-circle" class="mr-2"></i>Finalizar Venta
            </button>

            <h3 class="font-semibold mt-10 mb-2">Caja Chica</h3>
            <input id="monto-caja" type="number" step="0.01" placeholder="Monto" class="w-full p-2 border rounded mb-2" />
            <select id="tipo-caja" class="w-full p-2 border rounded mb-2">
              <option value="entrada">Entrada</option>
              <option value="salida">Salida</option>
            </select>
            <button onclick="agregarCajaChica()" class="w-full bg-gray-700 text-white py-2 rounded hover:bg-gray-900 transition flex justify-center items-center">
              <i data-feather="plus-circle" class="mr-2"></i>Registrar Movimiento
            </button>
            <ul id="movimientos-caja" class="mt-4 max-h-40 overflow-y-auto border rounded p-2 bg-white text-sm"></ul>
          </div>

        </div>
      </section>

      <!-- Productos -->
      <section id="productos" class="section hidden animate-fadeIn">
        <h2 class="text-3xl font-bold mb-4 flex items-center"><i data-feather="box" class="mr-2"></i>Gestión de Productos</h2>
        <div class="bg-white p-4 rounded shadow mb-4 flex flex-col md:flex-row md:space-x-4">
          <div class="flex-1 space-y-3">
            <label class="block text-sm"><i data-feather="tag" class="inline-block mr-1"></i>Nombre</label>
            <input id="prod-nombre" placeholder="Nombre" class="w-full p-2 border rounded" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            <label class="block text-sm"><i data-feather="hash" class="inline-block mr-1"></i>Código</label>
            <input id="prod-codigo" placeholder="Código" class="w-full p-2 border rounded" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            <label class="block text-sm"><i data-feather="dollar-sign" class="inline-block mr-1"></i>Precio de costo</label>
            <input id="prod-precio-costo" placeholder="Precio de costo" type="number" class="w-full p-2 border rounded" step="0.01" min="0" />
            <label class="block text-sm"><i data-feather="dollar-sign" class="inline-block mr-1"></i>Precio de venta</label>
            <input id="prod-precio-venta" placeholder="Precio de venta" type="number" class="w-full p-2 border rounded" step="0.01" min="0" />
            <label class="block text-sm"><i data-feather="layers" class="inline-block mr-1"></i>Stock</label>
            <input id="prod-stock" placeholder="Stock" type="number" class="w-full p-2 border rounded" min="0" />
            <button onclick="saveProduct()" class="bg-[#00BFFF] text-white px-4 py-2 rounded-lg shadow hover:bg-[#007ACC] transition flex items-center justify-center">
              <i data-feather="save" class="inline-block mr-1"></i>Guardar Producto
            </button>
          </div>
          <div class="flex-1 overflow-auto max-h-[520px]">
            <table class="w-full bg-white rounded shadow text-sm">
              <thead class="bg-gray-100">
                <tr>
                  <th class="p-2 text-left">Nombre</th>
                  <th class="p-2 text-left">Código</th>
                  <th class="p-2 text-right">Costo</th>
                  <th class="p-2 text-right">Venta</th>
                  <th class="p-2 text-right">Stock</th>
                  <th class="p-2 text-center">Acciones</th>
                </tr>
              </thead>
              <tbody id="prod-table"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Clientes -->
      <section id="clientes" class="section hidden animate-fadeIn">
        <h2 class="text-3xl font-bold mb-4 flex items-center"><i data-feather="users" class="mr-2"></i>Clientes</h2>
        <div class="bg-white p-4 rounded shadow mb-4">
          <label class="block mb-1 text-sm"><i data-feather="user-plus" class="inline-block mr-1"></i>Nombre</label>
          <input id="cli-nombre" placeholder="Nombre" class="w-full p-2 border rounded mb-2" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          <label class="block mb-1 text-sm"><i data-feather="mail" class="inline-block mr-1"></i>Email</label>
          <input id="cli-email" placeholder="Email" type="email" class="w-full p-2 border rounded mb-2" />
          <label class="block mb-1 text-sm"><i data-feather="phone-call" class="inline-block mr-1"></i>Teléfono</label>
          <input id="cli-telefono" placeholder="Teléfono" class="w-full p-2 border rounded mb-2" />
          <button onclick="saveClient()" class="bg-[#00BFFF] text-white px-4 py-2 rounded-lg shadow hover:bg-[#007ACC] transition flex items-center justify-center">
            <i data-feather="save" class="inline-block mr-1"></i>Guardar Cliente
          </button>
        </div>
        <ul id="client-list" class="bg-white p-4 rounded shadow h-80 overflow-y-auto"></ul>
      </section>

      <!-- Créditos -->
      <section id="creditos" class="section hidden animate-fadeIn">
        <h2 class="text-3xl font-bold mb-4 flex items-center"><i data-feather="credit-card" class="mr-2"></i>Créditos</h2>
        <p class="text-gray-600">Funcionalidad de créditos en desarrollo...</p>
      </section>

      <!-- Inventario -->
      <section id="inventario" class="section hidden animate-fadeIn">
        <h2 class="text-3xl font-bold mb-4 flex items-center"><i data-feather="database" class="mr-2"></i>Inventario</h2>
        <p class="text-gray-600">Gestión avanzada de inventario en desarrollo...</p>
      </section>

      <!-- Configuraciones -->
      <section id="configuraciones" class="section hidden animate-fadeIn">
        <h2 class="text-3xl font-bold mb-4 flex items-center"><i data-feather="settings" class="mr-2"></i>Configuraciones</h2>
        <p class="text-gray-600">Opciones de configuración próximamente...</p>
      </section>

      <!-- Reportes -->
      <section id="reportes" class="section hidden animate-fadeIn">
        <h2 class="text-3xl font-bold mb-4 flex items-center"><i data-feather="bar-chart-2" class="mr-2"></i>Reportes</h2>
        <div id="reporte" class="bg-white p-4 rounded shadow h-96 overflow-auto">
          <p>Generación y exportación de reportes próximamente...</p>
        </div>
      </section>

    </main>

  </section>

  <!-- Botones flotantes de impresión y exportar -->
  <div class="fixed bottom-4 right-4 z-50">
    <button onclick="imprimirTicket()" class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-800 transition flex items-center">
      <i data-feather="printer" class="inline-block mr-1"></i> Imprimir Ticket
    </button>
  </div>
  <div class="fixed bottom-4 left-4 z-50">
    <button onclick="exportarReporte()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg shadow hover:bg-indigo-800 transition flex items-center">
      <i data-feather="download" class="inline-block mr-1"></i> Exportar Reporte
    </button>
  </div>

  <script>
    feather.replace();

    // Variables globales
    let carrito = [];
    let productos = [];
    let clientes = [];
    let movimientosCaja = [];
    let vendedorActual = null;

    // LOGIN SIMPLIFICADO (admin/admin)
    document.getElementById('btnLogin').addEventListener('click', () => {
      const user = document.getElementById('user').value.trim();
      const pass = document.getElementById('pass').value.trim();
      if(user === 'admin' && pass === 'admin') {
        vendedorActual = 'Admin';
        document.getElementById('vendedor-info').textContent = vendedorActual;
        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('pos-section').classList.remove('hidden');
        document.getElementById('login-error').classList.add('hidden');
        showSection('ventas');
        document.getElementById('busqueda-container').classList.remove('hidden');
        document.getElementById('busqueda-producto').focus();
      } else {
        document.getElementById('login-error').classList.remove('hidden');
      }
    });

    // Navegación entre secciones
    function showSection(id) {
      const sections = document.querySelectorAll('.section');
      sections.forEach(sec => {
        if(sec.id === id) sec.classList.remove('hidden');
        else sec.classList.add('hidden');
      });
      // Mostrar u ocultar campo búsqueda solo en Ventas
      if(id === 'ventas') {
        document.getElementById('busqueda-container').classList.remove('hidden');
        document.getElementById('busqueda-producto').focus();
      } else {
        document.getElementById('busqueda-container').classList.add('hidden');
      }
    }

    // Buscar productos en ventas
    function buscarProductos() {
      const query = document.getElementById('busqueda-producto').value.toLowerCase();
      const resultados = productos.filter(p => p.nombre.toLowerCase().includes(query) || p.codigo.toLowerCase().includes(query));
      const lista = document.getElementById('lista-resultados');
      lista.innerHTML = '';
      if(query === '') return;
      resultados.forEach(p => {
        const item = document.createElement('div');
        item.className = 'p-2 border-b cursor-pointer hover:bg-[#00BFFF] hover:text-white transition';
        item.textContent = `${p.nombre} - $${p.precioVenta.toFixed(2)}`;
        item.onclick = () => agregarAlCarrito(p.codigo);
        lista.appendChild(item);
      });
    }

    // Agregar producto al carrito
    function agregarAlCarrito(codigo) {
      const producto = productos.find(p => p.codigo === codigo);
      if(!producto) return;
      const itemCarrito = carrito.find(i => i.codigo === codigo);
      if(itemCarrito) {
        itemCarrito.cantidad++;
      } else {
        carrito.push({ ...producto, cantidad: 1, descuento: 0 });
      }
      actualizarCarrito();
    }

    // Actualizar tabla carrito
    function actualizarCarrito() {
      const tbody = document.getElementById('carrito-items');
      tbody.innerHTML = '';
      let total = 0;
      carrito.forEach((item, index) => {
        const subtotal = item.cantidad * item.precioVenta * (1 - item.descuento / 100);
        total += subtotal;
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td class="p-2">${item.nombre}</td>
          <td class="p-2 w-20">
            <input type="number" min="1" value="${item.cantidad}" class="w-full border rounded p-1" oninput="cambiarCantidad(${index}, this.value)" />
          </td>
          <td class="p-2 w-24 text-right">$${item.precioVenta.toFixed(2)}</td>
          <td class="p-2 w-24 text-right">$${subtotal.toFixed(2)}</td>
          <td class="p-2 w-16">
            <input type="number" min="0" max="100" value="${item.descuento}" class="w-full border rounded p-1" oninput="cambiarDescuento(${index}, this.value)" />
          </td>
          <td class="p-2 w-14 text-center">
            <button class="text-red-600 hover:text-red-800" onclick="eliminarProducto(${index})" title="Eliminar producto">
              <i data-feather="trash-2"></i>
            </button>
          </td>`;
        tbody.appendChild(tr);
      });
      document.getElementById('total-venta').textContent = total.toFixed(2);
      feather.replace();
    }

    // Cambiar cantidad producto en carrito
    function cambiarCantidad(index, valor) {
      valor = parseInt(valor);
      if(isNaN(valor) || valor < 1) valor = 1;
      carrito[index].cantidad = valor;
      actualizarCarrito();
    }

    // Cambiar descuento producto en carrito
    function cambiarDescuento(index, valor) {
      valor = parseFloat(valor);
      if(isNaN(valor) || valor < 0) valor = 0;
      if(valor > 100) valor = 100;
      carrito[index].descuento = valor;
      actualizarCarrito();
    }

    // Eliminar producto del carrito
    function eliminarProducto(index) {
      carrito.splice(index, 1);
      actualizarCarrito();
    }

    // Aplicar descuento global
    function aplicarDescuentoGlobal() {
      let descGlobal = parseFloat(document.getElementById('descuento-global').value);
      if(isNaN(descGlobal) || descGlobal < 0) descGlobal = 0;
      if(descGlobal > 100) descGlobal = 100;
      carrito.forEach(item => item.descuento = descGlobal);
      actualizarCarrito();
    }

    // Cambiar método de pago
    function cambiarMetodoPago() {
      const metodo = document.getElementById('metodo-pago').value;
      if(metodo === 'Efectivo') {
        document.getElementById('efectivo-section').classList.remove('hidden');
      } else {
        document.getElementById('efectivo-section').classList.add('hidden');
        document.getElementById('cambio').textContent = '0.00';
      }
    }

    // Calcular cambio en efectivo
    function calcularCambio() {
      const recibido = parseFloat(document.getElementById('efectivo-recibido').value) || 0;
      const total = parseFloat(document.getElementById('total-venta').textContent) || 0;
      const cambio = recibido - total;
      document.getElementById('cambio').textContent = cambio >= 0 ? cambio.toFixed(2) : '0.00';
    }

    // Finalizar venta
    function finalizarVenta() {
      if(carrito.length === 0) {
        alert('No hay productos en el carrito');
        return;
      }
      alert('Venta finalizada por ' + vendedorActual + '. Total: $' + document.getElementById('total-venta').textContent);
      carrito = [];
      actualizarCarrito();
      document.getElementById('efectivo-recibido').value = '';
      document.getElementById('cambio').textContent = '0.00';
      document.getElementById('descuento-global').value = '0';
      // Aquí puedes agregar lógica para guardar la venta, etc.
    }

    // Agregar movimiento caja chica
    function agregarCajaChica() {
      const monto = parseFloat(document.getElementById('monto-caja').value);
      const tipo = document.getElementById('tipo-caja').value;
      if(isNaN(monto) || monto <= 0) {
        alert('Ingrese un monto válido');
        return;
      }
      movimientosCaja.push({ monto, tipo, fecha: new Date().toLocaleString() });
      actualizarMovimientosCaja();
      document.getElementById('monto-caja').value = '';
    }

    // Mostrar movimientos caja chica
    function actualizarMovimientosCaja() {
      const ul = document.getElementById('movimientos-caja');
      ul.innerHTML = '';
      movimientosCaja.forEach((mov, i) => {
        const li = document.createElement('li');
        li.textContent = `${mov.fecha} - ${mov.tipo === 'entrada' ? '+' : '-'} $${mov.monto.toFixed(2)}`;
        ul.appendChild(li);
      });
    }

    // Guardar producto (agregar o editar)
    function saveProduct() {
      const nombre = document.getElementById('prod-nombre').value.trim();
      const codigo = document.getElementById('prod-codigo').value.trim();
      const precioCosto = parseFloat(document.getElementById('prod-precio-costo').value);
      const precioVenta = parseFloat(document.getElementById('prod-precio-venta').value);
      const stock = parseInt(document.getElementById('prod-stock').value);

      if(!nombre || !codigo || isNaN(precioCosto) || isNaN(precioVenta) || isNaN(stock)) {
        alert('Complete todos los campos correctamente');
        return;
      }

      const existe = productos.findIndex(p => p.codigo === codigo);
      if(existe >= 0) {
        productos[existe] = { nombre, codigo, precioCosto, precioVenta, stock };
      } else {
        productos.push({ nombre, codigo, precioCosto, precioVenta, stock });
      }

      actualizarTablaProductos();
      limpiarCamposProducto();
      alert('Producto guardado');
    }

    // Limpiar campos producto
    function limpiarCamposProducto() {
      document.getElementById('prod-nombre').value = '';
      document.getElementById('prod-codigo').value = '';
      document.getElementById('prod-precio-costo').value = '';
      document.getElementById('prod-precio-venta').value = '';
      document.getElementById('prod-stock').value = '';
    }

    // Actualizar tabla productos
    function actualizarTablaProductos() {
      const tbody = document.getElementById('prod-table');
      tbody.innerHTML = '';
      productos.forEach((p, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2">${p.nombre}</td>
          <td class="p-2">${p.codigo}</td>
          <td class="p-2 text-right">$${p.precioCosto.toFixed(2)}</td>
          <td class="p-2 text-right">$${p.precioVenta.toFixed(2)}</td>
          <td class="p-2 text-right">${p.stock}</td>
          <td class="p-2 text-center">
            <button onclick="editarProducto(${i})" title="Editar" class="text-blue-600 hover:text-blue-800 mr-2">
              <i data-feather="edit-2"></i>
            </button>
            <button onclick="eliminarProductoLista(${i})" title="Eliminar" class="text-red-600 hover:text-red-800">
              <i data-feather="trash-2"></i>
            </button>
          </td>`;
        tbody.appendChild(tr);
      });
      feather.replace();
    }

    // Editar producto
    function editarProducto(index) {
      const p = productos[index];
      document.getElementById('prod-nombre').value = p.nombre;
      document.getElementById('prod-codigo').value = p.codigo;
      document.getElementById('prod-precio-costo').value = p.precioCosto;
      document.getElementById('prod-precio-venta').value = p.precioVenta;
      document.getElementById('prod-stock').value = p.stock;
    }

    // Eliminar producto de lista productos
    function eliminarProductoLista(index) {
      if(confirm('¿Eliminar este producto?')) {
        productos.splice(index,1);
        actualizarTablaProductos();
      }
    }

    // Guardar cliente
    function saveClient() {
      const nombre = document.getElementById('cli-nombre').value.trim();
      const email = document.getElementById('cli-email').value.trim();
      const telefono = document.getElementById('cli-telefono').value.trim();

      if(!nombre || !email || !telefono) {
        alert('Complete todos los campos correctamente');
        return;
      }

      clientes.push({ nombre, email, telefono });
      actualizarListaClientes();
      limpiarCamposCliente();
      alert('Cliente guardado');
    }

    // Limpiar campos cliente
    function limpiarCamposCliente() {
      document.getElementById('cli-nombre').value = '';
      document.getElementById('cli-email').value = '';
      document.getElementById('cli-telefono').value = '';
    }

    // Actualizar lista clientes
    function actualizarListaClientes() {
      const ul = document.getElementById('client-list');
      ul.innerHTML = '';
      clientes.forEach((c, i) => {
        const li = document.createElement('li');
        li.className = 'border-b p-2 flex justify-between items-center';
        li.innerHTML = `
          <span><strong>${c.nombre}</strong> - ${c.email} - ${c.telefono}</span>
          <button onclick="eliminarCliente(${i})" class="text-red-600 hover:text-red-800" title="Eliminar cliente">
            <i data-feather="trash-2"></i>
          </button>`;
        ul.appendChild(li);
      });
      feather.replace();
    }

    // Eliminar cliente
    function eliminarCliente(index) {
      if(confirm('¿Eliminar este cliente?')) {
        clientes.splice(index,1);
        actualizarListaClientes();
      }
    }

    // Imprimir ticket simple
    function imprimirTicket() {
      if(carrito.length === 0) {
        alert('El carrito está vacío.');
        return;
      }
      let html = `
        <div style="font-family: monospace; font-size: 14px; width: 280px; padding: 10px;">
          <h3 style="text-align: center;">JoVi POS</h3>
          <p>Fecha: ${new Date().toLocaleString()}</p>
          <p>Vendedor: ${vendedorActual}</p>
          <hr>
          <table style="width: 100%; border-collapse: collapse;">
            <thead><tr><th style="text-align:left;">Producto</th><th style="text-align:center;">Cant</th><th style="text-align:right;">Subtotal</th></tr></thead>
            <tbody>`;
      carrito.forEach(item => {
        const subtotal = item.cantidad * item.precioVenta * (1 - item.descuento/100);
        html += `<tr><td>${item.nombre}</td><td style="text-align:center;">${item.cantidad}</td><td style="text-align:right;">$${subtotal.toFixed(2)}</td></tr>`;
      });
      html += `
            </tbody>
          </table>
          <hr>
          <p style="text-align:right;"><strong>Total: $${document.getElementById('total-venta').textContent}</strong></p>
        </div>`;
      let ventana = window.open('','_blank','width=320,height=480');
      ventana.document.write(html);
      ventana.document.close();
      ventana.focus();
      ventana.print();
      ventana.close();
    }

    // Exportar reporte (solo sección reportes)
    function exportarReporte() {
      const reporte = document.getElementById('reporte');
      if(!reporte) return alert('No hay reporte visible');
      html2canvas(reporte).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jspdf.jsPDF();
        pdf.addImage(imgData, 'PNG', 10, 10, 190, 0);
        pdf.save('reporte-jovi.pdf');
      });
    }

    // Atajos de teclado para navegación F1-F7
    document.addEventListener('keydown', e => {
      if(e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
      switch(e.key) {
        case 'F1': e.preventDefault(); showSection('ventas'); break;
        case 'F2': e.preventDefault(); showSection('productos'); break;
        case 'F3': e.preventDefault(); showSection('clientes'); break;
        case 'F4': e.preventDefault(); showSection('creditos'); break;
        case 'F5': e.preventDefault(); showSection('inventario'); break;
        case 'F6': e.preventDefault(); showSection('configuraciones'); break;
        case 'F7': e.preventDefault(); showSection('reportes'); break;
      }
    });

  </script>

  <!-- Librerías para exportar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</body>
</html>
